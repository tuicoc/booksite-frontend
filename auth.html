<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Đăng nhập - Sách hay mỗi ngày</title>
<style>
/* Giữ nguyên CSS gốc để không đổi giao diện */
:root{
  --green:#3f6f4a;
  --light:#f2f6e9;
  --accent:#a7c789;
}
body{
  font-family:'Segoe UI',Roboto,Arial;
  margin:0;
  color:var(--green);
  background:linear-gradient(135deg,#f7f9f0 0%,#e8f4d8 100%);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.auth-container{background:white;border-radius:24px;box-shadow:0 20px 60px rgba(63,111,74,0.15);overflow:hidden;max-width:900px;width:100%;display:flex;min-height:550px;}
.auth-left{flex:1;background:linear-gradient(135deg,var(--green) 0%,#2d5236 100%);padding:60px 40px;display:flex;flex-direction:column;justify-content:center;color:white;position:relative;overflow:hidden;}
.auth-left h1{font-size:42px;margin:0 0 16px 0;font-weight:800;}
.auth-left p{font-size:18px;opacity:0.95;line-height:1.6;}
.auth-right{flex:1;padding:60px 50px;display:flex;flex-direction:column;justify-content:center;}
.auth-tabs{display:flex;gap:20px;margin-bottom:40px;border-bottom:2px solid #e0e7d3;}
.auth-tab{background:none;border:none;padding:12px 24px;font-size:18px;font-weight:600;color:#999;cursor:pointer;}
.auth-tab.active{color:var(--green);}
.auth-tab.active::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:3px;background:var(--green);}
.auth-form{display:flex;flex-direction:column;gap:20px;}
.form-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--green);font-size:14px;}
.form-group input{width:100%;padding:14px 16px;border:2px solid #e0e7d3;border-radius:12px;font-family:inherit;font-size:15px;}
.btn-submit{background:var(--green);color:white;border:none;padding:16px 32px;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;}
.btn-submit:hover{background:#2d5236;}
.feedback{margin-top:16px;padding:12px;border-radius:8px;font-size:14px;text-align:center;}
.feedback.error{background:#ffe6e6;color:#d32f2f;}
.feedback.success{background:#e6f7e6;color:#2e7d32;}
#register-form{display:none;}

/* ============================= */
/* Nút Quay về trang chủ         */
/* ============================= */
.back-home {
  margin-top: 32px;
  text-align: center;
}

.back-home a {
  display: inline-block;
  background: var(--green);
  color: white;
  padding: 12px 28px;
  border-radius: 20px;
  font-weight: 700;
  text-decoration: none;
}


</style>
</head>
<body>

<div class="auth-container">
  <div class="auth-left">
    <h1>Sách hay<br/>mỗi ngày</h1>
    <p>Khám phá thế giới qua từng trang sách. Tham gia cộng đồng yêu sách và chia sẻ trải nghiệm đọc của bạn.</p>
  </div>
  
  <div class="auth-right">
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Đăng nhập</button>
      <button class="auth-tab" onclick="switchTab('register')">Đăng ký</button>
    </div>
    
    <!-- Login Form -->
    <form id="login-form" class="auth-form">
      <div class="form-group">
        <label for="login-username">Tên đăng nhập</label>
        <input type="text" id="login-username" required placeholder="Nhập username...">
      </div>
      <div class="form-group">
        <label for="login-password">Mật khẩu</label>
        <input type="password" id="login-password" required placeholder="Nhập mật khẩu...">
      </div>
      <button type="submit" class="btn-submit">Đăng nhập</button>
    </form>
    
    <!-- Register Form -->
    <form id="register-form" class="auth-form">
      <div class="form-group">
        <label for="register-username">Tên đăng nhập</label>
        <input type="text" id="register-username" required placeholder="Chọn username...">
      </div>
      <div class="form-group">
        <label for="register-displayname">Tên hiển thị</label>
        <input type="text" id="register-displayname" required placeholder="Tên của bạn...">
      </div>
      <div class="form-group">
        <label for="register-password">Mật khẩu</label>
        <input type="password" id="register-password" required placeholder="Tạo mật khẩu...">
      </div>
      <button type="submit" class="btn-submit">Đăng ký</button>
    </form>
    
    <div id="feedback"></div>
    <div class="back-home"><a href="index.html">← Quay về trang chủ</a></div>
  </div>
</div>

<script>
const API_BASE = 'https://booksite-backend-production.up.railway.app/api';

function switchTab(tab) {
  const tabs = document.querySelectorAll('.auth-tab');
  tabs.forEach(t => t.classList.remove('active'));
  if (tab === 'login') {
    tabs[0].classList.add('active');
    document.getElementById('login-form').style.display = 'flex';
    document.getElementById('register-form').style.display = 'none';
  } else {
    tabs[1].classList.add('active');
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('register-form').style.display = 'flex';
  }
  document.getElementById('feedback').innerHTML = '';
}

function showFeedback(msg, error = false) {
  const fb = document.getElementById('feedback');
  fb.className = 'feedback ' + (error ? 'error' : 'success');
  fb.textContent = msg;
}

// ---------- LOGIN ----------
document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('login-username').value;
  const password = document.getElementById('login-password').value;
  try {
    const res = await fetch(API_BASE + '/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password }),
    });
    const data = await res.json();
    if (res.ok && data.token) {
      // ✅ Lưu token thống nhất với app.js
      localStorage.setItem('jwt', data.token);
      showFeedback('Đăng nhập thành công! Đang chuyển hướng...', false);
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    } else {
      showFeedback(data.message || 'Đăng nhập thất bại', true);
    }
  } catch {
    showFeedback('Không thể kết nối server', true);
  }
});

// ---------- REGISTER ----------
document.getElementById('register-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('register-username').value;
  const displayName = document.getElementById('register-displayname').value;
  const password = document.getElementById('register-password').value;
  try {
    const res = await fetch(API_BASE + '/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password, displayName }),
    });
    const data = await res.json();
    if (res.ok) {
      showFeedback('Đăng ký thành công! Mời đăng nhập.', false);
      setTimeout(() => switchTab('login'), 1500);
    } else {
      showFeedback(data.message || 'Đăng ký thất bại', true);
    }
  } catch {
    showFeedback('Không thể kết nối server', true);
  }
});
</script>
</body>
</html>
